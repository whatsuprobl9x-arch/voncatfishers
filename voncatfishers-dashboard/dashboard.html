<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VonCatfishers â€” Dashboard</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header class="topbar">
    <h2 id="brand">VonCatfishers</h2>
    <div id="userInfo"></div>
    <button id="logoutBtn" class="btn small">Log out</button>
  </header>

  <main class="container">
    <aside class="sidebar">
      <button class="nav-btn" data-tab="home">Home</button>
      <button class="nav-btn" data-tab="content">Content</button>
      <button class="nav-btn" data-tab="support">Support</button>
      <button class="nav-btn" data-tab="payments">Payments</button>
    </aside>

    <section class="main-panel" id="mainPanel">
      <!-- content loaded by JS -->
      <div id="homeTab" class="tab">
        <h3>Welcome</h3>
        <div id="roleArea"></div>
      </div>

      <div id="contentTab" class="tab hidden">
        <h3>Content</h3>
        <div id="contentArea"></div>
      </div>

      <div id="supportTab" class="tab hidden">
        <h3>Support</h3>
        <div id="supportArea"></div>
      </div>

      <div id="paymentsTab" class="tab hidden">
        <h3>Payments / Balance</h3>
        <div id="paymentsArea"></div>
      </div>
    </section>
  </main>

  <footer class="footer-note">
    In order to send your content, please host it using <a href="https://mega.nz" target="_blank">MEGA</a> or <a href="https://mediafire.com" target="_blank">MediaFire</a> and enter the link here!
  </footer>

  <script src="js/config.example.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/model.js"></script>
  <script>
    // basic tab switching
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const tab = btn.dataset.tab;
        document.querySelectorAll('.tab').forEach(t=>t.classList.add('hidden'));
        document.getElementById(tab+'Tab').classList.remove('hidden');
      });
    });

    document.getElementById('logoutBtn').addEventListener('click', async ()=>{
      await logout();
    });

    // on load, initialize dashboard
    (async function init(){
      await ensureAuthRedirect(); // defined in auth.js
      const u = await currentUser();
      document.getElementById('userInfo').innerText = u.email;
      document.getElementById('roleArea').innerText = 'Role: ' + u.role;
      if (u.role === 'admin') {
        await admin_init(u);
      } else {
        await model_init(u);
      }
    })();
  </script>
</body>
</html>
